#Enable binauth before this and modify the policy to include the binauth attestor.
gcloud container binauthz policy import > current_policy_export.yaml
gcloud container binauthz policy import current_policy.yaml
#Now build the application from the source using buildpacks
gcloud builds submit --tag=gcr.io/rmishra-kubernetes-playground/product-listing-api:binauth
#Now list the attestors:
gcloud container binauthz attestors list
#Modify the terraform config to include the image and also make sure binauth is enabled on cloud run
#Deployed with cloud build image, went fine
#Build locally with docker
docker push -t gcr.io/rmishra-kubernetes-playground/product-listing-api:nobinauth
docker push -t gcr.io/rmishra-kubernetes-playground/product-listing-api:nobinauth
#Error when binauth fails
Error: resource is in failed state "Ready:False", message: Container image 'gcr.io/rmishra-kubernetes-playground/product-listing-api@sha256:81a7a088debb1b38198a3e00900d26f7e1fdeea6f1869e94a120185b8443cf71' is not authorized by policy. Image gcr.io/rmishra-kubernetes-playground/product-listing-api@sha256:81a7a088debb1b38198a3e00900d26f7e1fdeea6f1869e94a120185b8443cf71 denied by attestor projects/rmishra-kubernetes-playground/attestors/built-by-cloud-build: No attestations found that were valid and signed by a key trusted by the attestor
#Revert to binauth image
#Service is up and running again